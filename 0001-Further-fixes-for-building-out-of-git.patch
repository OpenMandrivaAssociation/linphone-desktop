From 7f4d5524ea9cf69e84a36656b0cef28c685e72e5 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jani=20V=C3=A4limaa?= <wally@mageia.org>
Date: Fri, 24 Jul 2020 19:38:13 +0300
Subject: [PATCH] Further fixes for building out-of-git

---
 linphone-app/build/CMakeLists.txt                    |  5 -----
 .../cmake_builder/linphone_package/CMakeLists.txt    | 12 ++----------
 2 files changed, 2 insertions(+), 15 deletions(-)

diff --git a/linphone-app/build/CMakeLists.txt b/linphone-app/build/CMakeLists.txt
index 8ef03fa..97d94bd 100644
--- a/linphone-app/build/CMakeLists.txt
+++ b/linphone-app/build/CMakeLists.txt
@@ -46,11 +46,6 @@ set(CPACK_SOURCE_IGNORE_FILES
   "libmng.spec"
 )
 
-bc_compute_full_version(PROJECT_VERSION_BUILD)
-if(PROJECT_VERSION_BUILD)
-  set(CPACK_PACKAGE_FILE_NAME "${CPACK_PACKAGE_NAME}-${PROJECT_VERSION_BUILD}")
-endif()
-
 message("-- Package file name is ${CPACK_PACKAGE_FILE_NAME}")
 
 set(CPACK_SOURCE_PACKAGE_FILE_NAME ${CPACK_PACKAGE_FILE_NAME})
diff --git a/linphone-app/cmake_builder/linphone_package/CMakeLists.txt b/linphone-app/cmake_builder/linphone_package/CMakeLists.txt
index 9549b59..309cc15 100644
--- a/linphone-app/cmake_builder/linphone_package/CMakeLists.txt
+++ b/linphone-app/cmake_builder/linphone_package/CMakeLists.txt
@@ -38,16 +38,8 @@ set(LINPHONE_QML_DIR "${CMAKE_CURRENT_SOURCE_DIR}/../../ui")
 # ==============================================================================
 # Build package version.
 # ==============================================================================
-bc_compute_full_version(APP_PROJECT_VERSION)
-if (GIT_EXECUTABLE AND NOT(APP_PROJECT_VERSION))
-  execute_process(
-    COMMAND ${GIT_EXECUTABLE} describe --always
-    OUTPUT_VARIABLE APP_PROJECT_VERSION
-    OUTPUT_STRIP_TRAILING_WHITESPACE
-    WORKING_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/../.."
-  )
-elseif (NOT(APP_PROJECT_VERSION))
-  set(APP_PROJECT_VERSION "0.0.0")
+if (NOT(APP_PROJECT_VERSION))
+  set(APP_PROJECT_VERSION "4.2.2")
 endif ()
 string(REGEX REPLACE "([0-9.]+)-?.*" "\\1" LINPHONE_VERSION "${APP_PROJECT_VERSION}")
 string(REPLACE "." ";" SPLITTED_LINPHONE_VERSION "${LINPHONE_VERSION}")
-- 
2.27.0

